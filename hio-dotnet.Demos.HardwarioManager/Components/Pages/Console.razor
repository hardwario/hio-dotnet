@page "/console"
@using hio_dotnet.PhoneDrivers.BLE

@inject ChesterBLEService BleService

<ConsoleComponent Output="output" OnSendCommand="HandleSendCommand" />

@code {
    private List<string> output = new List<string>();

    protected override void OnInitialized()
    {
        BleService.NewConsoleLineOutputReceived += OnNewLineReceived;
    }

    private async Task HandleSendCommand(string command)
    {
        output.Add("> " + command);
        await BleService.SendCommand(BleService.ConnectedPeripheral, command.ToLower().Trim() + "\n");
    }

    private void OnNewLineReceived(object sender, string newLine)
    {
        InvokeAsync(() =>
        {
            output.Add(newLine);
            StateHasChanged();
        });
    }
}
